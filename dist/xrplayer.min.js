!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).xrPlayer=e()}(this,function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var a="object"==typeof t&&t&&t.Object===Object&&t,n="object"==typeof self&&self&&self.Object===Object&&self,l=a||n||Function("return this")(),r=l.Symbol,o=Object.prototype,i=o.hasOwnProperty,c=o.toString,s=r?r.toStringTag:void 0;var u=function(t){var e=i.call(t,s),n=t[s];try{var r=!(t[s]=void 0)}catch(t){}var o=c.call(t);return r&&(e?t[s]=n:delete t[s]),o},d=Object.prototype.toString;var h=function(t){return d.call(t)},p=r?r.toStringTag:void 0;var m=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":(p&&p in Object(t)?u:h)(t)};var v=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var f,y=function(t){if(!v(t))return!1;var e=m(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},g=l["__core-js_shared__"],b=(f=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||""))?"Symbol(src)_1."+f:"";var x=function(t){return!!b&&b in t},E=Function.prototype.toString;var D=function(t){if(null!=t){try{return E.call(t)}catch(t){}try{return t+""}catch(t){}}return""},C=/^\[object .+?Constructor\]$/,_=Function.prototype,w=Object.prototype,j=_.toString,L=w.hasOwnProperty,O=RegExp("^"+j.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var P=function(t){return!(!v(t)||x(t))&&(y(t)?O:C).test(D(t))};var F=function(t,e){return null==t?void 0:t[e]};var T=function(t,e){var n=F(t,e);return P(n)?n:void 0},k=function(){try{var t=T(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var A=function(t,e,n){"__proto__"==e&&k?k(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var S=function(t,e){return t===e||t!=t&&e!=e},B=Object.prototype.hasOwnProperty;var I=function(t,e,n){var r=t[e];B.call(t,e)&&S(r,n)&&(void 0!==n||e in t)||A(t,e,n)};var N=function(t,e,n,r){var o=!n;n=n||{};for(var i=-1,a=e.length;++i<a;){var l=e[i],c=r?r(n[l],t[l],l,n,t):void 0;void 0===c&&(c=t[l]),(o?A:I)(n,l,c)}return n};function H(t){return t}var M=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},q=Math.max;var R=function(i,a,l){return a=q(void 0===a?i.length-1:a,0),function(){for(var t=arguments,e=-1,n=q(t.length-a,0),r=Array(n);++e<n;)r[e]=t[a+e];e=-1;for(var o=Array(a+1);++e<a;)o[e]=t[e];return o[a]=l(r),M(i,this,o)}};var W=function(t){return function(){return t}},K=k?function(t,e){return k(t,"toString",{configurable:!0,enumerable:!1,value:W(e),writable:!0})}:H,$=Date.now;var z=function(n){var r=0,o=0;return function(){var t=$(),e=16-(t-o);if(o=t,0<e){if(800<=++r)return arguments[0]}else r=0;return n.apply(void 0,arguments)}}(K);var U=function(t,e){return z(R(t,e,H),t+"")};var V=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991};var X=function(t){return null!=t&&V(t.length)&&!y(t)},G=/^(?:0|[1-9]\d*)$/;var Y=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&G.test(t))&&-1<t&&t%1==0&&t<e};var J=function(t,e,n){if(!v(n))return!1;var r=typeof e;return!!("number"==r?X(n)&&Y(e,n.length):"string"==r&&e in n)&&S(n[e],t)};var Q=function(l){return U(function(t,e){var n=-1,r=e.length,o=1<r?e[r-1]:void 0,i=2<r?e[2]:void 0;for(o=3<l.length&&"function"==typeof o?(r--,o):void 0,i&&J(e[0],e[1],i)&&(o=r<3?void 0:o,r=1),t=Object(t);++n<r;){var a=e[n];a&&l(t,a,n,o)}return t})};var Z=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r};var tt=function(t){return null!=t&&"object"==typeof t};var et=function(t){return tt(t)&&"[object Arguments]"==m(t)},nt=Object.prototype,rt=nt.hasOwnProperty,ot=nt.propertyIsEnumerable,it=et(function(){return arguments}())?et:function(t){return tt(t)&&rt.call(t,"callee")&&!ot.call(t,"callee")},at=Array.isArray;function lt(){return!1}var ct=e(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n?l.Buffer:void 0,i=(o?o.isBuffer:void 0)||lt;t.exports=i}),st={};st["[object Float32Array]"]=st["[object Float64Array]"]=st["[object Int8Array]"]=st["[object Int16Array]"]=st["[object Int32Array]"]=st["[object Uint8Array]"]=st["[object Uint8ClampedArray]"]=st["[object Uint16Array]"]=st["[object Uint32Array]"]=!0,st["[object Arguments]"]=st["[object Array]"]=st["[object ArrayBuffer]"]=st["[object Boolean]"]=st["[object DataView]"]=st["[object Date]"]=st["[object Error]"]=st["[object Function]"]=st["[object Map]"]=st["[object Number]"]=st["[object Object]"]=st["[object RegExp]"]=st["[object Set]"]=st["[object String]"]=st["[object WeakMap]"]=!1;function ut(t){return tt(t)&&V(t.length)&&!!st[m(t)]}var dt=function(e){return function(t){return e(t)}},ht=e(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n&&a.process,i=function(){try{var t=r&&r.require&&r.require("util").types;return t?t:o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i}),pt=ht&&ht.isTypedArray,mt=pt?dt(pt):ut,vt=Object.prototype.hasOwnProperty;var ft=function(t,e){var n=at(t),r=!n&&it(t),o=!n&&!r&&ct(t),i=!n&&!r&&!o&&mt(t),a=n||r||o||i,l=a?Z(t.length,String):[],c=l.length;for(var s in t)!e&&!vt.call(t,s)||a&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Y(s,c))||l.push(s);return l},yt=Object.prototype;var gt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||yt)};var bt=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},xt=Object.prototype.hasOwnProperty;var Et=function(t){if(!v(t))return bt(t);var e=gt(t),n=[];for(var r in t)("constructor"!=r||!e&&xt.call(t,r))&&n.push(r);return n};var Dt=function(t){return X(t)?ft(t,!0):Et(t)},Ct=Q(function(t,e){N(e,Dt(e),t)}),_t={width:600,height:400,currentTime:0,volume:.5,autoplay:!1,playerPage:!0,debug:!1,basePath:"",baseHost:""},wt=[{name:"player",dev:"{baseHost}/public/player.css",pro:"{basePath}/player.css"},{name:"xr_icon",dev:"//at.alicdn.com/t/font_1741137_x7unuco9bf8.css",pro:"//at.alicdn.com/t/font_1741137_x7unuco9bf8.css"}];var jt=function(e,n){return function(t){return e(n(t))}}(Object.keys,Object),Lt=Object.prototype.hasOwnProperty;var Ot=function(t){if(!gt(t))return jt(t);var e=[];for(var n in Object(t))Lt.call(t,n)&&"constructor"!=n&&e.push(n);return e};var Pt=function(t){return(X(t)?ft:Ot)(t)},Ft=Object.prototype.hasOwnProperty,Tt=Q(function(t,e){if(gt(e)||X(e))N(e,Pt(e),t);else for(var n in e)Ft.call(e,n)&&I(t,n,e[n])});function kt(t){this.domEl.posterDom.setAttribute("src",t||this.options.poster)}function At(t){var e=this.common.createChild,n=this.common.createBtn,r=e("div","xr-control-wrap"),o=e("div","xr-control",r),i=function(t){var e=this.common.createChild,n=e("div","xr-progress_bar_container"),r=e("div","xr-progress_list",n),o=e("div","xr-progress_line",r),i=e("div","xr-progress_currentCircle",o);return t&&t.appendChild(n),{progressBarContainerDom:n,progressListDom:r,progressLineDom:o,progressCurrentCircleDom:i}}.call(this,o),a=i.progressBarContainerDom,l=i.progressListDom,c=i.progressLineDom,s=i.progressCurrentCircleDom,u=function(t){var e=(0,this.common.createChild)("div","xr-left-control");return t&&t.appendChild(e),e}.call(this,o),d=function(t){var e=(0,this.common.createChild)("div","xr-right-control");return t&&t.appendChild(e),e}.call(this,o),h=function(t){var e=(0,this.common.createChild)("span","xr-control-play");return this.common.addClass.call(e,"xr_icon xr_icon_play"),t&&t.appendChild(e),e}.call(this),p=function(t){var e=this.common.createChild,n=e("div","xr-proLines"),r=e("span","xr-control-current"),o=e("span","xr-control-duration"),i=document.createTextNode("/");return r.innerHTML="00:00:00",o.innerHTML="00:00:00",n.appendChild(r),n.appendChild(i),n.appendChild(o),t&&t.appendChild(n),{proLinesDom:n,currentDom:r,durationDom:o,proLinesLineDom:i}}.call(this),m=p.proLinesDom,v=p.currentDom,f=p.durationDom,y=p.proLinesLineDom,g=function(t){var e=this.common.createChild,n=e("div","xr-control-voice-mark xr_icon xr_icon_sound-on"),r=e("div","xr-control-voice"),o=e("div","xr-voiceline",r),i=e("div","xr-voice-drag",o),a=document.createDocumentFragment();return a.appendChild(n),a.appendChild(r),t&&t.appendChild(a),{voiceMarkDom:n,voiceDom:r,voiceLineDom:o,voiceDragDom:i,voiceOP:a}}.call(this),b=g.voiceOP,x=g.voiceMarkDom,E=g.voiceDom,D=g.voiceLineDom,C=g.voiceDragDom,_=function(t){var e=(0,this.common.createChild)("span","xr-control-full xr_icon xr_icon_expand-arrows");return t&&t.appendChild(e),e}.call(this);n(h,u),n(m,u),n(b,d),n(_,d),t&&t.appendChild(r);var w={controlWrapDom:r,controlDom:o,progressBarContainerDom:a,progressListDom:l,progressLineDom:c,progressCurrentCircleDom:s,leftControlDom:u,rightControlDom:d,controlPlayDom:h,proLinesDom:m,currentDom:v,durationDom:f,proLinesLineDom:y,voiceOP:b,voiceMarkDom:x,voiceDom:E,voiceLineDom:D,voiceDragDom:C,fullDom:_};return this.domEl=Tt(this.domEl,w),w}function St(t,e,n){var r=document.createElement(t);return e&&(r.className=e),n&&n.appendChild(r),r}function Bt(t){if("string"!=typeof t)throw Error("className type is not string");return t.replace("  "," ").split(" ")}function It(t){var e=Bt(this.className);t.split(" ").length<2?-1===e.indexOf(t.trim())&&e.push(t):Bt(t).map(function(t){-1===e.indexOf(t.trim())&&e.push(t)});return this.className=e.join(" "),this}function Nt(e){var t=Bt(this.className).map(function(t){if(t!=e)return t});return this.className=t.join(" "),this}var Ht=function(t){var e,n,r;if(!(null==t||t<0))return e=t/3600|0,t=parseInt(t)-3600*e,parseInt(e)<10&&(e="0"+e),n=t/60|0,r=parseInt(t)-60*n,parseInt(n)<10&&(n="0"+n),r<10&&(r="0"+r),e+":"+n+":"+r};function Mt(t){return t.currentStyle||window.getComputedStyle(t,null)}function qt(t){var e=Ht(parseInt(t));this.domEl.currentDom.innerHTML=e}var Rt={createChild:St,createBtn:function(t,e){var n=St("div","xr-control-btn",e);return n.appendChild(t),n},addClass:It,removeClass:Nt};function Wt(t){t=t||this.videoEl;var e=parseInt(t.currentTime/t.duration*1e4)/1e4,n=Mt(this.domEl.progressBarContainerDom).width;this.domEl.progressCurrentCircleDom.style.display="block",this.domEl.progressCurrentCircleDom.style.left=e*parseFloat(n)+"px",this.domEl.progressLineDom.style.width=e*parseFloat(n)+"px"}function Kt(t){var e=this.domEl.playerDom,n=this.videoEl,r=this.domEl.canvasDom,o=r.getContext("2d"),i=parseFloat(getComputedStyle(e).width),a=parseFloat(getComputedStyle(e).height),l=(r.width=i)/(r.height=a),c=n.videoWidth/n.videoHeight,s=r.width,u=r.height,d=0,h=0;if(c<l){var p=a*n.videoWidth/n.videoHeight;d=(i-p)/2,s=p}else{var m=i*n.videoHeight/n.videoWidth;h=(a-m)/2,u=m}o.drawImage(n,d,h,s,u),qt.call(this,n.currentTime),Wt.call(this),n.ended&&!t&&Xt.call(this)}function $t(t,e){var n=this.domEl.controlPlayDom,r=this.domEl.startBarDom;this.videoEl.paused&&!t||e?(Nt.call(n,"xr_icon_play"),It.call(n,"xr_icon_pause"),Nt.call(r,"xr_icon_bofangliang"),It.call(r,"xr_icon_zanting1"),r.style.display="none"):(Nt.call(n,"xr_icon_pause"),It.call(n,"xr_icon_play"),Nt.call(r,"xr_icon_zanting1"),It.call(r,"xr_icon_bofangliang"),r.style.display="block")}var zt=function(){var e=this;(function(){this.Timer=window.setInterval(Kt.bind(this),0)}).call(this),this.videoEl.play().then(function(){(function(){this.domEl.posterWarpDom.style.display="none"}).call(e),e.options.autoplay&&$t.call(e,!1,!0)}).catch(function(t){e.options.autoplay&&function(){var t=this;function e(){zt.call(t),window.top.document.removeEventListener("click",e),window.top.document.removeEventListener("touchend",e)}window.top.document.addEventListener("click",e),window.top.document.addEventListener("touchend",e)}.call(e)})},Ut=function(){var t=this;this.videoEl.pause(),Kt.call(this,!0),setTimeout(function(){clearInterval(t.Timer),t.Timer=null},0)};function Vt(t){t&&t.preventDefault(),$t.call(this,!1),this.videoEl.paused?zt.call(this):Ut.call(this)}var Xt=function(){Ut.call(this),qt.call(this,0),Wt.call(this),$t.call(this,!0),this.addListenerList.ended&&this.addListenerList.ended(),clearInterval(this.Timer),this.Timer=null};function Gt(t){var e=this,n=this.options.debug;t.onloadedmetadata=function(){t.currentTime=e.options.currentTime,Wt.call(e,t),function(t){var e=Ht(parseInt(t));this.domEl.durationDom.innerHTML=e}.call(e,t.duration),$t.call(e,!0)},t.onloadstart=function(){n&&console.log("loadstart")},t.ondurationchange=function(){n&&console.log("durationchange")},t.onloadeddata=function(){n&&console.log("loadeddata")},t.onprogress=function(){n&&console.log("progress")},t.oncanplay=function(){n&&console.log("canplay")},t.oncanplaythrough=function(){n&&console.log("canplaythrough")}}function Yt(){var t=document.createElement("video");t.src=this.options.src,t.preload="metadata",this.videoEl=t,Gt.call(this,t),this.load=function(e){return function(t){e.src=t.src,this.options.autoplay=!0,Vt.call(this),kt.call(this,t.poster)}.bind(this)}.call(this,t)}function Jt(){var i=this;wt.forEach(function(t){var e,n,r,o=t.pro;(o=(o=o.replace("{baseHost}",i.options.baseHost)).replace("{basePath}",i.options.basePath))&&(e=o,n=document.getElementsByTagName("head")[0],(r=document.createElement("link")).type="text/css",r.rel="stylesheet",r.href=e,n.appendChild(r))})}function Qt(t){var e=t.toString(),n=e.charAt(e.length-1);return isNaN(+n)?t:t+"px"}function Zt(t){this.videoEl.volume=t;var e=this.domEl.voiceMarkDom,n=this.domEl.voiceLineDom,r=this.domEl.voiceDragDom;0<this.videoEl.volume?(Nt.call(e,"xr_icon_sound-off"),It.call(e,"xr_icon_sound-on")):(Nt.call(e,"xr_icon_sound-on"),It.call(e,"xr_icon_sound-off"));var o=parseInt(100*t);n.style.width=o+"%",r.style.left=o+"%"}function te(t){"BODY"==t.target.nodeName?this.isKeypress=!1:this.isKeypress=!0,32==t.keyCode&&Vt.call(this)}function ee(){var n=this,t=this.videoEl,r=this.domEl.playerDom,e=this.domEl.fullDom;r.addEventListener("fullscreenchange",function(){document.fullscreenElement?(n.fullscreen=!0,Nt.call(e,"xr_icon_expand-arrows"),It.call(e,"xr_icon_compress-arrows-alt")):(n.fullscreen=!1,Nt.call(e,"xr_icon_compress-arrows-alt"),It.call(e,"xr_icon_expand-arrows")),t.paused&&refreshCanvas.call(n,!0)},!1),e.addEventListener("click",function(t){var e;n.isKeypress?n.isKeypress=!1:n.fullscreen?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExiFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e=r).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen()})}function ne(){var l=this,c=this.videoEl;this.domEl.playerDom,this.domEl.progressBarContainerDom.addEventListener("mousedown",function(t){var r=this.getBoundingClientRect().left,o=this.offsetWidth,i=document.getElementsByTagName("html")[0];function a(t){var e=(t.pageX-r)/o;e<0&&(e=0),1<e&&(e=1),c.currentTime=e*c.duration,Wt.call(l),i.style.cursor="pointer"}document.addEventListener("mousemove",a),document.addEventListener("mouseup",function t(e){var n=(e.pageX-r)/o;n<0&&(n=0),1<n&&(n=1),c.currentTime=n*c.duration,c.paused&&Vt.call(l),Wt.call(l),i.style.cursor="auto",document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",t),clearInterval(l.Timer),zt.call(l)})})}function re(){var l=this,t=this.videoEl,e=this.domEl.voiceMarkDom,n=this.domEl.voiceDom;e.addEventListener("click",function(){0<t.volume?(l.oldVolume=t.volume,Zt.call(l,0)):Zt.call(l,l.oldVolume||.5)}),n.addEventListener("mousedown",function(t){var r=this.getBoundingClientRect().left,o=this.offsetWidth,i=document.getElementsByTagName("html")[0];function a(t){var e=(t.pageX-r)/o;e<0&&(e=0),1<e&&(e=1),Zt.call(l,e),i.style.cursor="pointer"}document.addEventListener("mousemove",a),document.addEventListener("mouseup",function t(e){var n=(e.pageX-r)/o;n<0&&(n=0),1<n&&(n=1),Zt.call(l,n),i.style.cursor="auto",document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",t)})})}function oe(){(function(){var t=this.domEl.controlPlayDom,e=this.domEl.shadowDom,n=this;t.addEventListener("click",function(t){n.isKeypress?n.isKeypress=!1:Vt.call(n,t)},!0),e.addEventListener("click",function(t){Vt.call(n,t)},!0)}).call(this),ee.call(this),ne.call(this),re.call(this),function(){var e=this,t=this.domEl.playerDom;e.options.playerPage?document.onkeypress=function(t){te.call(e,t)}:(document.addEventListener("click",function(){e.isPlayer=!1}),t.addEventListener("click",function(){event.stopPropagation(),e.isPlayer=!0}),document.onkeypress=function(t){t.preventDefault(),t.stopPropagation(),e.isPlayer&&te.call(e,t)})}.call(this)}function ie(){Jt.call(this),Yt.call(this),this.domEl={};var t=function(){var t=document.querySelector(this.options.el);this.common.addClass.call(t,"xr-player-dom"),t.style.width=Qt(this.options.width),t.style.height=Qt(this.options.height);var e=parseFloat(Mt(t).width),n=parseFloat(Mt(t).height);return this.videoEl.width=e,this.videoEl.height=n,this.domEl.playerDom=t}.call(this);return function t(e){var n=(0,this.common.createChild)("canvas","xr-video-canvas");return t.width=this.videoEl.width,t.height=this.videoEl.height,e&&e.appendChild(n),this.domEl.canvasDom=n}.call(this,t),function(t){var e=this.common.createChild,n=e("div","xr-poster-wrap"),r=e("img","xr-poster",n);t&&t.appendChild(n);var o={posterWarpDom:n,posterDom:r};return this.domEl=Tt(this.domEl,o),kt.call(this),o}.call(this,t),function(t){var e=this.common.createChild,n=e("div","xr-player-shadow"),r=e("div","xr-startBar xr_icon xr_icon_bofangliang",n);t&&t.appendChild(n);var o={shadowDom:n,startBarDom:r};return this.domEl=Tt(this.domEl,o),o}.call(this,t),At.call(this,t),function(){Zt.call(this,this.options.volume),oe.call(this),this.addListener=function(){return this.addListenerList={},function(t,e){this.addListenerList[t]=e}.bind(this)}.call(this)}.call(this),this.options.autoplay&&($t.call(this,!1),zt.call(this)),this}function ae(t){return this.options=Ct(_t,t),this.Timer=null,this.fullscreen=null,this.oldVolume=0,this.isPlayer=!1,this.isKeypress=!1,ie.call(this)}return function(e){var n=document.getElementsByTagName("script");try{var t=n[n.length-1].getAttribute("src");e.basePath=t.substring(0,t.lastIndexOf("/")+1)}catch(t){for(var r=n.length-1;0<=r;r--){var o=n[r];if(o.getAttribute("src")&&-1<o.getAttribute("src").indexOf("xrplayer")){var i=o.getAttribute("src");e.basePath=i.substring(0,i.lastIndexOf("/")+1)}}}e.baseHost=e.basePath.substring(0,function(t,e,n){for(var r=t.indexOf(e),o=0;o<n-1;o++)r=t.indexOf(e,r+1);return r}(e.basePath,"/",3))}(_t),ae.prototype.common=Rt,ae});
